#!/usr/bin/env python3

from pwn import *

HOST = os.environ.get('HOST', 'localhost')
PORT = 31337

io = remote(HOST, int(PORT))

io.recvuntil(b'Some functions have non-random names, use those names in call order to get the password.\n\n')

import os
import base64
import time

for i in range(10):
    io.recvuntil(b'Watchme: ')
    base64_encoded = io.recvuntil(b'\n').strip()
    fp = open('challenge', 'wb')
    fp.write(base64.b64decode(base64_encoded))
    fp.close()
    os.system('chmod +x challenge')
    os.system('python3 sym.py')
    os.system('./nbuns > res')
    with open('res', 'r') as f:
        password = f.read()
    io.sendline(password.strip())
time.sleep(0.1)
io.recvuntil(b"Here's that flag:")
flag = io.recvline().decode()
print(flag)

io.interactive()
